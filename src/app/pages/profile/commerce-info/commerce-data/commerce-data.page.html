<app-header [backButton]="true" [titlePage]="'Datos del negocio'"></app-header>

<ion-content *ngIf="commerce">
  <div class="edit_profile_main_content">
    <form [formGroup]="commerceForm">
      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['name'].value ? 'fill-input' : ''"
      >
        <ion-label>Nombre</ion-label>
        <ion-input
          formControlName="name"
          (ionFocus)="onFocus($event)"
      
          type="text"
          [value]="commerce?.name"
          autocapitalize="true"
          class="ion-text-right"
          [maxlength]="50"
        ></ion-input>
      </ion-item>
      <div class="px-4" *ngIf="name.invalid && name.touched">
        <ion-text color="danger" *ngIf="name.errors.duplicated">
          <p class="ion-no-margin"><sub>Este nombre ya existe en Yeasy.</sub></p>
        </ion-text>
        <ion-text color="danger" *ngIf="name.errors.required">
          <p class="ion-no-margin"><sub>Este campo es requerido</sub></p>
        </ion-text>
      </div>
      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['email'].value ? 'fill-input' : ''"
      >
        <ion-label>Email</ion-label>
        <ion-input
          formControlName="email"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="email"
          [value]="commerce?.email"
          class="ion-text-right"
          [maxlength]="150"
        ></ion-input>
      </ion-item>

      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['phone'].value ? 'fill-input' : ''"
      >
        <ion-label>Teléfono</ion-label>
        <ion-intl-tel-input
          class="ion-text-right absolute right-[7px] float-right w-1/2"
          [enableAutoCountrySelect]="true"
          [defaultCountryiso]="'es'"
          [preferredCountries]="['es']"
          [maxLength]="'9'"
          [modalSearchPlaceholder]="'Buscar...'"
          [modalCloseText]="'Cerrar'"
          formControlName="phone"
          [inputPlaceholder]="'600 123 456'"
          modalTitle="Seleccione país"
        ></ion-intl-tel-input>
      </ion-item>
      <div class="px-4" *ngIf="phoneNumber.invalid && phoneNumber.touched">
        <ion-text color="danger" *ngIf="phoneNumber.errors.required">
          <p class="ion-no-margin"><sub>El teléfono es requerido</sub></p>
        </ion-text>
        <ion-text color="danger" *ngIf="phoneNumber.errors.phone">
          <p class="ion-no-margin"><sub>El teléfono no es válido.</sub></p>
        </ion-text>
      </div>
      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['address'].value ? 'fill-input' : ''"
      >
        <ion-label>Dirección</ion-label>
        <ion-input
          formControlName="address"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="text"
          [value]="commerce?.address"
          autocapitalize="true"
          class="ion-text-right"
          [maxlength]="150"
        ></ion-input>
      </ion-item>

      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['municipality'].value ? 'fill-input' : ''"
      >
        <ion-label>Localidad</ion-label>
        <ion-input
          formControlName="municipality"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="text"
          [value]="commerce?.municipality"
          autocapitalize="true"
          class="ion-text-right"
          [maxlength]="150"
        ></ion-input>
      </ion-item>

      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['city'].value ? 'fill-input' : ''"
      >
        <ion-label>Ciudad</ion-label>
        <ion-input
          formControlName="city"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="text"
          [value]="commerce?.city"
          autocapitalize="true"
          class="ion-text-right"
          [maxlength]="50"
        ></ion-input>
      </ion-item>

      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['province'].value ? 'fill-input' : ''"
      >
        <ion-label>Provincia</ion-label>
        <ion-input
          formControlName="province"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="text"
          [value]="commerce?.province"
          autocapitalize="true"
          class="ion-text-right"
          [maxlength]="50"
        ></ion-input>
      </ion-item>

      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['postCode'].value ? 'fill-input' : ''"
      >
        <ion-label>Código postal</ion-label>
        <ion-input
          formControlName="postCode"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="number"
          [value]="commerce?.postCode"
          autocapitalize="true"
          class="ion-text-right"
          inputmode="numeric"
          [maxlength]="5"
        ></ion-input>
      </ion-item>
      <ion-item
      class="textbox"
      [ngClass]="commerceForm.controls['slug'].value ? 'fill-input' : ''"
    >
      <ion-label>Mi URL</ion-label>
      <ion-input
        formControlName="slug"
        (ionFocus)="onFocus($event)"
        
        (ionChange)="checkIfSlugExist($event)"
        type="text"
        [value]="commerce?.slug"
        autocapitalize="true"
        class="ion-text-right"
        [maxlength]="50"
      ></ion-input>
    </ion-item>
    <div class="px-4" *ngIf="slug.invalid && slug.touched">
      <ion-text color="danger" *ngIf="slug.errors.duplicated">
        <p class="ion-no-margin"><sub>Este nombre ya existe en Yeasy.</sub></p>
      </ion-text>
      <ion-text color="danger" *ngIf="name.errors.required">
        <p class="ion-no-margin"><sub>Este campo es requerido</sub></p>
      </ion-text>
    </div>
      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['description'].value ? 'fill-input' : ''"
      >
        <ion-label>Descripción</ion-label>
        <ion-textarea
          autoGrow="true"
          [placeholder]="'Breve descripción de tu negocio (recomendado)'"
          formControlName="description"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          [value]="commerce?.description"
          autocapitalize="true"
        ></ion-textarea>
      </ion-item>
      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['website'].value ? 'fill-input' : ''"
      >
        <ion-label>Sitio web</ion-label>
        <ion-input
          formControlName="website"
          placeholder="https://dominio.com"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="text"
          [value]="commerce?.website"
          class="ion-text-right"
          [maxlength]="100"
        ></ion-input>
      </ion-item>
      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['facebook'].value ? 'fill-input' : ''"
      >
        <ion-label>Facebook</ion-label>
        <ion-input
          formControlName="facebook"
          placeholder="Nombre de usuario"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="text"
          [value]="commerce?.facebook"
          class="ion-text-right"
          [maxlength]="100"
        ></ion-input>
      </ion-item>
      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['instagram'].value ? 'fill-input' : ''"
      >
        <ion-label>Instagram</ion-label>
        <ion-input
          formControlName="instagram"
          placeholder="Nombre de usuario"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="text"
          [value]="commerce?.instagram"
          class="ion-text-right"
          [maxlength]="100"
        ></ion-input>
      </ion-item>
      <ion-item
        class="textbox"
        [ngClass]="commerceForm.controls['linkedin'].value ? 'fill-input' : ''"
      >
        <ion-label>Linkedin</ion-label>
        <ion-input
          formControlName="linkedin"
          placeholder="Nombre de usuario"
          (ionFocus)="onFocus($event)"
          (ionBlur)="onBlur($event)"
          type="text"
          [value]="commerce?.linkedin"
          class="ion-text-right"
          [maxlength]="100"
        ></ion-input>
      </ion-item>
    </form>

    <ion-accordion-group (ionChange)="changeAccordion($event)">
      <ion-accordion value="timetable">
        <ion-item class="textbox" slot="header">
          <ion-label>{{timetableText}}</ion-label>
        </ion-item>

        <form [formGroup]="timeTableForm" slot="content">
          <ion-grid fixed>
            <ion-list>
              <ion-row
                *ngFor="let day of weekDays"
                (click)="goToConfigureSchedule(day)"
              >
                <ion-item class="textbox hour-list w-full">
                  <ion-col class="no-padding" size="3">
                    <ion-label class="no-padding"
                      >{{day | translateDays | titlecase}}</ion-label
                    >
                  </ion-col>
                  <ion-col size="8">
                    <ion-label *ngIf="timeTableForm.controls[day].value">
                      {{timeTableForm.controls['checkinTime'+day].value
                      }}{{timeTableForm.controls['departureTime'+day].value }}
                    </ion-label>
                    <ion-label *ngIf="!timeTableForm.controls[day].value">
                      Cerrado
                    </ion-label>
                  </ion-col>
                  <ion-col size="1">
                    <ion-icon name="chevron-forward-outline"></ion-icon>
                  </ion-col>
                </ion-item>
              </ion-row>
            </ion-list>
          </ion-grid>
        </form>
      </ion-accordion>
    </ion-accordion-group>
  </div>
</ion-content>

<ion-footer class="ion-no-border" *ngIf="commerce">
  <ion-grid>
    <ion-row>
      <ion-col>
        <ion-button
          [disabled]="!commerceForm.valid"
          (click)="saveCommerce()"
          class="btn"
          expand="block"
        >
          Guardar
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-footer>
